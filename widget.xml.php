<?php

$FILE_SEPARATOR = ':: ';

$IMAGE = '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';


function sep( $str ) {
	return explode(': ',str);
}

function get( $str ) {
	global $lins;
	foreach($lins as $l) {
		$p = explode(': ',$l);
		if ($p[0]==$str) return $p[1];           
	}
	return null;
}

function getTime( $t ) {
	return date('H:i:s d/m/y',$t);
}

function formatN( $str )
{
	$str = "$str";
	$r = "";
	$c = 0;
	for($i=strlen($str)-1; $i>=0; $i--) {
		$r = $str[$i] . $r;
		if ($c>=2 && $i>0) {
			$r = ".$r";
			$c = 0;
		}
		$c+=1;
	}
	return $r;
}

//obtem arquivo
$sumario = file_get_contents('sumario_online.log');
//$sumario = file_get_contents('sumario.log');
$lins = explode("\n", $sumario);

$info = array(
	'ultimoacesso' 		=> get('Hora do registro'),
	'totaldearquivos'	=> get('Total de arquivos'),
	'ultimototarq' 		=> get('Total de arquivos da ultima amostragem'),
	'novosarquivos' 	=> get('Arquivos adicionados'),
	'apagadarquivos' 	=> get('Arquivos apagados'),
	'modarquivos' 		=> get('Arquivos modificados'),
	'totaldebytes' 		=> get('Total de bytes')
);

//Listas modificados
$modificados = explode("Lista de arquivos modificados:\n", $sumario );
$modificados = explode(":::\n",$modificados[1]);
$modificados = explode("\n",$modificados[0]);
array_pop($modificados); 

//Listas adicionados
$adicionados = explode("Lista de arquivos adicionados:\n", $sumario );
$adicionados = explode(":::\n",$adicionados[1]);
$adicionados = explode("\n",$adicionados[0]);
array_pop($adicionados); 

//Listas apagados
$apagados = explode("Lista de arquivos apagados:\n", $sumario );
$apagados = explode(":::\n",$apagados[1]);
$apagados = explode("\n",$apagados[0]);
array_pop($apagados); 

$lista = array( $adicionados, $modificados, $apagados );
$listaTot = count($adicionados) + count($modificados) + count($apagados);

$styles = array("add","mod","rem");
$styleC = 0;
$titles = array("Adicionado","Modificado","Removido");

$delay = time() - strtotime($info['ultimoacesso']);
$delay = floor( $delay / 3600 );
$d = floor($delay/24);
if ($delay>24) {
	$delay = $d . " dias e " . ($delay-$d*24) . " horas";
} else {
	$delay = $d . " horas";
}
?>
	<style>
		#wwp_monit_container {
			width: 180px;
			height: auto;
			font-size:10px;
			background: #ffffff url(data:image/png;base64,'.$IMAGE.') no-repeat;
			overflow: hidden;
		}
		
		#wwp_monit_container table {
			width: 100%;
			margin:0;
			cursor: pointer;
		}
			
		#wwp_monit_container th {
			border: #add8e6 solid 2px;
			background: #dbe2e4;
			font-size:10px;
		}
		
		#wwp_monit_container td {
			border: #add8e6 solid 1px;
			margin: 0 0 1px 0;
			font-size:9px;
			padding-left: 3px;
		}
		
		#wwp_monit_container td div {
			width: 160px;
			overflow: hidden;
		}
		
		#wwp_monit_container .ico {
			width: 13px;
			height: 13px;
		}
		#wwp_monit_container .add {
			background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAMAAABFNRROAAAAAXNSR0IArs4c6QAAAb9QTFRFAAAA////Y3NLWmNLa3xKe4xKc4RKjJxKhJRKAAAAWmtLZHpLUlpKXHFLY2tKAAAAe4NLfZJLAAAAUmNKbYRLkZ1MAAAAAAAAS1lKh5lKdHtKg41JSlJKAAAACAgIYWVLtbSuAAAAcopLjJtSbXJKUVJSsLKsaWxKWVtL+vv3R0RMUlNKk6NLkp5TSEpLCAgIAAAAlaVZTVBQVGlKiJVSTEpRCAgI1tbOnqxjna1aMzMzlKRRAAAACAgIzMzMCgoNtbW05ebeeH1Ja3tCQ0JJ3t3Wvr62DQwOp7VsUVlRKSkqk55chI5RcXRIWmFQGRkaEBAPCgoNhJRiOTk79/b39fbxxMO9fYVQYnVEUUxL8fDuo7BqgZJEfY1Xa3xTVVdYQUFCFRQXAAAAk5tzjJVLh5Jse4xBISEiAAAA7vHmcoNTdINBO0A8KjAnWVpbSFJCOD0ywMqRnqtsk5x6jJV1g5VScH1CIykh4eDdx8fEtLigprN8ipNtfoxlVFNYRUlIpLNjbYJFX2hQQUtAO0Izq62moq16GxseEhIV1tnGxMe0vMOmtsKGtsN6qq6cZ3VUKyovGyAaGxsex86wvr68M3jzrAAAAAF0Uk5TAEDm2GYAAAABYktHRACIBR1IAAAACXBIWXMAAArwAAAK8AFCrDSYAAAAB3RJTUUH2gUJFCsoknMLLAAAAJhJREFUCNdjYAABg1wbBhhIZ+ZjYWL2g3BkmLl4eZlYeHlAHD0uPiZuRhZubiYJII+ZiYXFmTGVrZGNiYGBU4TFXJMRBNgiOhj8mdjYnKsYNdmSBUQKGOS42VhZWRnTOATZVOwZGIRZWTk4GKslJZXlQbYxCXKIsrOLWqjXg6xQ5VJi762W4lOFWM+px8XEzOMFd1sSJ8SdAL2oDlE08bbkAAAAAElFTkSuQmCC);
		}
		
		#wwp_monit_container .rem {
			background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAMAAABFNRROAAAAAXNSR0IArs4c6QAAAb9QTFRFAAAA3oB0nFFK/5yOznNrKSAQ13ht7o2D13tzpVVQvWheIx4PCAAAxWtjlEtI1HNr95qMrVpTpFJLAAAA3oR6/72ttl1X54l9znFm5oV79pOG/qaaEAAAlFFLtWNb95aMvWJam01J/6SV/riq5YN3xW5n/8GyAAAA75KG/7WlzGZmrlxX/62ehUNApVlS/rCjjUlE3Xtys1tUAAAA8JWKhEhCMSIQjExIxWlefENA7ol9nFVRAAAA2IN5OikYvWtjAAAAz3tyzHltxXNrikVB5o2D9/f2+J6S9I+D////EwUE7ezqrFVPIh0LrmJbAAAAAAAAejw5AAAApVxXnlhSMSgXwnFlUyclczk0YCsoAAAAZjMzQCobQhoZGQkI7+/v5+blNRYUIBkISiIhMBAPIAgIdDs5GxgIkktDEQYGxGVghUE7ZUo6GQEB4+Pg76WXc01CRTAhxcTASjIh3dzZIg0NCAAAEQYGEQYGqHlptGpjY1pOKREQKAkIEwUE+LamWDkrShoYNRYUIg0NsK2mxoBwSEAyShoYEQYGoZ6XGBIAQhoZMBAPzMzMYj0xEQYGSiIhQhoZSiIhKREQKREQ23LhIwAAAAF0Uk5TAEDm2GYAAAABYktHRACIBR1IAAAACXBIWXMAAArwAAAK8AFCrDSYAAAAB3RJTUUH2gUJFCwQ9TAldQAAAKRJREFUCNdjYAACGRERRhsGCJjCJs8sLS0gkgriZHII6CiLKrtr2MYBeSzsSr2sasre7CKqDAw8HB5K3tyamvHsHKo2DCEiHsyd3NLMrOz8XMEMfoySUqzcUuyshhJiIQwRToYqwX2MhqxsvHqyDM1yEvz8/CwSElxiekA7ZcXkFBQ4s8R8OM1BFppzCoEAk3kU2DGBBnxAYBoEdVsZT0pcJogBADfOFKjAMF9xAAAAAElFTkSuQmCC);
		}

		#wwp_monit_container .mod {
			background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAMAAABFNRROAAAAAXNSR0IArs4c6QAAAb9QTFRFAAAAAAAAy6hMzq1KnHxJtZRK4sNMrYxKn4JKvZxK27dLpopJpYRK1bBL0LFKso9LxKVK3bxK1rVJt5pKAAAAwp9LlXhK5L9Jk3NKwKJK781a7sli3rpQ8M5k785pk3NSAAAA58VKAAAAr5JM7MhR9dhyAAAACAcCAAAA9thkDQoI5sVS5sZh58RZ7chZ+N5z9dZrAAAA9NBpk3RY78xS+eV6AAAA7MhM8NVtEREHmntalnpTAAAAalkp+N94lHxa+N1qq41BjXUytJVDn4FceWQwCAgI8tVZ7dVkmn1jPzMZFxIJJCEPGBcKCAgIMSkR5L1S17dSlXlhlHs5Y1InUkMgOC0Z5dBi1b5ao4Y/KSAYIBoM8dZw3cJcdGEuQzgdKSIQxKdRS0IgAAAAyKxSnYFChnA0WUojGxoXvZ5CrJFBpIRkm4I7IRsW5MFZ27ZRzK1Sn5JEmntSlHZfYlAvSjsiOzAjMSoZKygSIBkSDQoIgmtTERAPJyQfCAgIIR8aCAcC5s1dzLRVQDQoSUY9Qj40QT03GhcSERAPGhcSERAPCAcCtZs+lnw/hG4wdWJLCAgIOzkyMjApLyskGhcSkmo1sAAAAAF0Uk5TAEDm2GYAAAABYktHRACIBR1IAAAACXBIWXMAAArwAAAK8AFCrDSYAAAAB3RJTUUH2gUJFCs7Fs1K8gAAAKBJREFUCNc1jr0OgjAURu+9pZRCSW2J5ScqMdGFYGRCWR1InJ2cjJuzD6CP4CsL/pzpO9N3AAaqXJ4r+MFmaZ364e0jZP3Fel/79jnIhNlVs202xjKAjhh2xbwwGDOEqaSrWe58g5Rz0Imk2JqQkZQCDpojMUZ0QqHgEekEBy6JChCgVEJzzUUU3Mc/5ymlosBz35ZXljlXHv9pbY99O443gaUMdDKG+FEAAAAASUVORK5CYII=);
		}

	</style>
	<div id="wwp_monit_container" >
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th colspan="2">Ultimos "updates"</th>
				</tr>
			</thead>
			<tbody>
				<?php
					for ($i=0; $i<$listaTot; $i++)
					{
						$el = &$lista[0];
						if (count($el)==0)
						{
							array_shift($lista);
							$el = &$lista[0];
							$styleC ++;
						}
						$dt = explode($FILE_SEPARATOR,array_shift($el));
				?>
				<tr>
					<td title="<?php echo getTime($dt[1]); ?>"><div><?php echo $dt[0]; ?></div></td>
					<td class="ico <?php echo $styles[$styleC]; ?>" title="<?php echo $titles[$styleC]; ?>"><span class="ico">&nbsp;</span></td>
				</tr>
				<?php
					}
				?>
			</tbody>
		</table>
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th colspan="2">Estatísticas</th>
				</tr>
			</thead>
			<tbody>
				<!-- <tr>
					<td>Novos arquivos</td>
					<td><?php echo formatN($info['novosarquivos']); ?></td>
				</tr> -->
				<tr>
					<td>Total de arquivos</td>
					<td><?php echo formatN($info['totaldearquivos']); ?></td>
				</tr>
				<tr>
					<td>Total de MB</td>
					<td><?php echo formatN(round($info['totaldebytes']/1048576)); ?></td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="2">
						<?php echo $delay; ?> atráz
					</td>
				</tr>
			</tfoot>
		</table>
	</div>
